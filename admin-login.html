<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Login Admin - Restaurante</title>
  <link rel="stylesheet" href="styles.css"/>
</head>
<body>
    <div class="login-container">
  <div class="login-card" style="margin-top:40px;">
    <h2>Login Administrador</h2>
    <form id="admin-login-form">
      <div class="form-group">
        <label for="admin-name">Nome</label>
        <input id="admin-name" type="text" required />
      </div>
      <div class="form-group">
        <label for="admin-pass">Senha</label>
        <input id="admin-pass" type="password" required />
      </div>
      <div class="form-actions">
        <button class="btn btn-primary" type="submit">Entrar</button>
        <a href="index.html" class="btn">Voltar</a>
      </div>
    </form>
  </div>
  </div>

  <script>
    (function(){
      const ADMIN_KEY = 'adminUser';
      const ADMIN_TOKEN_KEY = 'adminToken';
      document.getElementById('admin-login-form').addEventListener('submit', async function(e){
        e.preventDefault();
        const nome = document.getElementById('admin-name').value.trim();
        const senha = document.getElementById('admin-pass').value.trim();
        if(!nome || !senha) return alert('Preencha campos');

        try {
          const res = await fetch('/api/login', {
            method: 'POST', headers: {'Content-Type':'application/json'},
            body: JSON.stringify({ nome, senha })
          });
          if (!res.ok) {
            const d = await res.json().catch(()=>({message:'Erro'}));
            alert(d.message || 'Erro no login');
            return;
          }
          const data = await res.json();
          if (data.tipo !== 'admin') { alert('Usuário não é admin'); return; }
          // salvar admin + token com expiry
          localStorage.setItem(ADMIN_KEY, JSON.stringify({ nome: data.nome, tipo: data.tipo }));
          localStorage.setItem(ADMIN_TOKEN_KEY, JSON.stringify({ token: data.token, expiresAt: data.expiresAt }));
          // redirecionar para index
          window.location.href = 'index.html';
        } catch (err) {
          console.error(err); alert('Erro ao conectar');
        }
      });
    })();
  </script>
</body>
</html>